<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AGRI DOST | Disease Detection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .cursor-pointer { cursor: pointer; }
  </style>
</head>
<body class="bg-gray-100">

  <div class="flex min-h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-md flex flex-col justify-between">
      <div>
        <div class="p-6 border-b">
          <h1 class="text-2xl font-extrabold text-green-700">AGRI DOST</h1>
          <p class="text-sm text-gray-500">Smart Farming Dashboard</p>
        </div>
        <nav class="mt-4 space-y-2">
          <a href="home.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-green-50">
            <span class="material-icons mr-3">Home</span> Home
          </a>
          <a href="dashboard.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-green-50">
            <span class="material-icons mr-3">dashboard</span> Dashboard
          </a>
          <a href="disease-detection.html" class="flex items-center px-6 py-3 bg-green-100 text-green-800 font-semibold">
            <span class="material-icons mr-3">healing</span> Disease Detection
          </a>
          <a href="market-price.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-green-50">
            <span class="material-icons mr-3">show_chart</span> Market Prices
          </a>
          <a href="crop-sell.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-green-50">
            <span class="material-icons mr-3">shopping_cart</span> Crop Shopping
          </a>
        </nav>
      </div>
      <div class="border-t p-4">
        <a href="settings.html" class="flex items-center text-gray-700 hover:text-green-700 mb-3">
          <span class="material-icons mr-3">settings</span> Settings
        </a>
        <a href="help.html" class="flex items-center text-gray-700 hover:text-green-700">
          <span class="material-icons mr-3">help_outline</span> Help
        </a>
      </div>
    </aside>

    <!-- Main Section -->
    <main class="flex-1 p-8 overflow-y-auto">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800">AI-Powered Disease Detection</h2>
      </div>

      <div class="bg-white p-8 rounded-2xl shadow-md">
        <h3 class="text-xl font-semibold text-green-700 mb-2 flex items-center">
          <span class="material-icons mr-2">camera_alt</span> Upload Crop Image
        </h3>
        <p class="text-gray-500 mb-6">Upload an image of your crop leaf or plant to detect diseases using AI.</p>

        <form class="space-y-6">
          <!-- Upload box -->
          <div class="border-2 border-dashed border-green-400 rounded-xl p-10 text-center cursor-pointer"
               onclick="document.getElementById('fileUpload').click()">
            <span class="material-icons text-green-600 text-5xl mb-2">cloud_upload</span>
            <p class="text-gray-700 font-medium">Drag & Drop or Click to Upload</p>
            <input type="file" accept="image/*" class="hidden" id="fileUpload">
            <p id="fileName" class="text-sm mt-2 text-gray-500">No file selected</p>
          </div>

          <div>
            <label class="font-medium">Crop Type *</label>
            <select class="w-full p-3 mt-2 border rounded-md focus:ring-green-500 focus:border-green-500">
              <option>Select crop</option>
              <option>Wheat</option>
              <option>Rice</option>
              <option>Tomato</option>
              <option>Cotton</option>
            </select>
          </div>

          <div class="text-right">
            <button type="submit" class="bg-green-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-green-700 transition">
              Detect Disease
            </button>
          </div>
        </form>
      </div>

      <!-- Results Section -->
      <div class="mt-10 bg-white p-8 rounded-2xl shadow-md">
        <h3 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
          <span class="material-icons text-green-600 mr-2">bug_report</span> Detection Results
        </h3>
        <div class="border p-5 rounded-xl bg-green-50">
          <p class="font-semibold text-green-700">Result:</p>
          <p id="resultText" class="text-gray-700 mt-2">No disease detected. Your crop looks healthy! ðŸŒ¿</p>
        </div>
      </div>

      <footer class="mt-10 text-center text-gray-600 text-sm">
        Â© 2025 AGRI DOST | Empowering Farmers with AI
      </footer>
    </main>
  </div>

  <!-- JS -->
  <script>
    const fileInput = document.getElementById("fileUpload");
    const fileName = document.getElementById("fileName");
    const form = document.querySelector("form");
    const resultText = document.getElementById("resultText");

    // Display selected file name
    fileInput.addEventListener("change", () => {
      if(fileInput.files.length > 0){
        fileName.textContent = fileInput.files[0].name;
      } else {
        fileName.textContent = "No file selected";
      }
    });

    // Submit form
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const file = fileInput.files[0];
      if (!file) {
        alert("Please upload an image first!");
        return;
      }

      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.innerHTML = 'Processing...';
      submitBtn.disabled = true;
      resultText.innerText = "Analyzing image...";

      const formData = new FormData();
      formData.append("file", file);

      try {
        const response = await fetch("http://127.0.0.1:5000/predict", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();
        console.log(data);

        if (data.error) {
          resultText.innerHTML = `<span class="text-red-600">Error: ${data.error}</span>`;
        } else {
          // Use the text result from backend (Disease/No Disease)
          const result = data.result || (data.prediction === 1 ? "Disease" : "No Disease");
          const confidence = data.score ? ` (Confidence: ${(data.score * 100).toFixed(1)}%)` : '';
          
          resultText.innerHTML = `
            <div class="${data.prediction === 1 ? 'text-red-600' : 'text-green-600'} font-semibold">
              Result: ${result}${confidence}
            </div>
            <div class="text-gray-600 mt-2 text-sm">
              Image saved as: ${data.filepath || 'unknown'}
            </div>
          `;
        }
      } catch (error) {
        console.error(error);
        resultText.innerHTML = '<span class="text-red-600">Error connecting to server. Is the backend running?</span>';
      } finally {
        // Restore button state
        submitBtn.innerHTML = originalBtnText;
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
